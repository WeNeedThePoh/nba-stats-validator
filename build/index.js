import{populateHtml as populateHtml}from"./populate.js";import{getGameId as getGameId,getGameData as getGameData,getTeamLogo as getTeamLogo}from"./external.js";window.onload=()=>{const t=document.getElementById("open-file-btn"),e=document.createElement("input");e.type="file",t.onclick=()=>{e.click()},e.onchange=t=>{const e=t.target.files[0],n=e.name.replace(".htm",""),r=new FileReader;r.readAsText(e,"utf16le"),r.onload=t=>{!async function(t,e){const n=new DOMParser,r=n.parseFromString(t,"text/html"),o=r.querySelectorAll("table"),a=o[0],s=o[1],i=o[2],l=o[3];e=function(t,e){let n=t.querySelectorAll("tr")[1].firstElementChild.textContent;n=n.split(" Vs ");const r=e.substring(0,3),o=e.slice(-3);return n.map((t,e)=>{return function(e,t){let n=e.substring(0,3);var r=[{name:"Golden State",triCode:"GSW"},{name:"Los Angeles",triCode:["LAC","LAL"]},{name:"New York",triCode:"NYK"},{name:"New Orleans",triCode:"NOP"},{name:"Oklahoma City",triCode:"OKC"},{name:"Brooklyn",triCode:"BKN"},{name:"San Antonio",triCode:"SAS"},{name:"Phoenix",triCode:"PHX"},{name:"Washington",triCode:"WSH"}].filter(t=>t.name===e);0<r.length&&(n=r[0].triCode,Array.isArray(n)&&n.includes(t)&&(n=t));return{name:e.toLowerCase(),triCode:n.toUpperCase()}}(t,0===e?r:o)})}(a,e);e=function(t,e,n){let r=e.querySelectorAll("tr");r=[].slice.call(r,3),r.splice(-1,1),r=u(r);let o=n.querySelectorAll("tr");return o=[].slice.call(o,3),o.splice(-2,2),o=u(o),t[0].stats=r[r.length-1],r.splice(-1,1),t[0].players=r,t[1].stats=o[o.length-1],o.splice(-1,1),t[1].players=o,t}(e=function(t,e){for(var[n,r]of e.entries()){var o=t.querySelectorAll("tr")[n+1].children,n=o.length;r.score={firstP:parseInt(o[2].textContent,10)},5===n?(r.score.secondP=void 0,r.score.thirdP=void 0,r.score.fourthP=void 0,r.score.final=parseInt(o[4].textContent,10)):7===n?(r.score.secondP=parseInt(o[4].textContent,10),r.score.thirdP=void 0,r.score.fourthP=void 0,r.score.final=parseInt(o[6].textContent,10)):(r.score.secondP=parseInt(o[4].textContent,10),r.score.thirdP=parseInt(o[6].textContent,10),r.score.fourthP=parseInt(o[8].textContent,10),r.score.final=parseInt(o[10].textContent,10))}return e}(s,e),i,l);const c={startsAt:function(t){const e=t.querySelectorAll("tr")[2].firstElementChild.textContent,[n]=e.split(" ");return new Date(n)}(a),location:function(t){const e=t.querySelectorAll("tr")[2].firstElementChild.textContent,[,n]=e.split(" at ");return n}(a),teams:e},m=`${c.startsAt.getFullYear()}${("0"+(c.startsAt.getMonth()+1)).slice(-2)}${c.startsAt.getDate()}`,p=await getGameId(m,e),d=await getGameData(m,p);c.startsAt=function(t,e){const n=t.querySelectorAll("tr")[2].firstElementChild.textContent,[r]=n.split(" "),o=e.basicGameData.startTimeEastern.replace("ET","");return new Date(`${r} ${o} EST`)}(a,d),c.teams=function(t,e){const n={};e.basicGameData.vTeam.triCode===t[0].triCode?(t[0].id=e.basicGameData.vTeam.teamId,n.visitor=t[0],t[1].id=e.basicGameData.hTeam.teamId,n.host=t[1]):(t[1].id=e.basicGameData.vTeam.teamId,n.visitor=t[1],t[0].id=e.basicGameData.hTeam.teamId,n.host=t[0]);return n.host.logo=getTeamLogo(n.host.id),n.visitor.logo=getTeamLogo(n.visitor.id),n}(e,d),c.gameData=d,window.fileData=c,populateHtml(c)}(t.target.result,n)}};function u(t){const e=[];for(const u of t){const[C,f,I,g,h,x,A,P,v,y,,G,S,w,T,D]=u.querySelectorAll("td");var[n,r]=C.textContent.split(","),[o,a]=g.textContent.trim().split("-"),s=+(parseInt(o,10)/parseInt(a,10)*100).toFixed(2)||0,[i,l]=h.textContent.trim().split("-"),c=+(parseInt(i,10)/parseInt(l,10)*100).toFixed(2)||0,[m,p]=x.textContent.trim().split("-"),d=+(parseInt(m,10)/parseInt(p,10)*100).toFixed(2)||0;e.push({firstName:r,lastName:n,position:f.textContent.trim(),minutes:I.textContent.trim(),fieldGoalsMade:parseInt(o,10),fieldGoalsAttempts:parseInt(a,10),fieldGoalsPercentage:s,threePointsMade:parseInt(i,10),threePointsAttempts:parseInt(l,10),threePointsPercentage:c,freeThrowMade:parseInt(m,10),freeThrowAttempts:parseInt(p,10),freeThrowPercentage:d,offensiveRebounds:parseInt(A.textContent.trim(),10),defensiveRebounds:parseInt(P.textContent.trim(),10),totalRebounds:parseInt(v.textContent.trim(),10),assists:parseInt(y.textContent.trim(),10),personalFouls:parseInt(G.textContent.trim(),10),steals:parseInt(S.textContent.trim(),10),turnouvers:parseInt(w.textContent.trim(),10),blocks:parseInt(T.textContent.trim(),10),points:parseInt(D.textContent.trim(),10)})}return e}};